<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sinal Automático - Pullback M5</title>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; text-align: center; }
    select, button { margin: 10px; padding: 6px; }
    #sinal { font-size: 24px; font-weight: bold; margin-top: 10px; }
    #historico { margin-top: 20px; max-height: 200px; overflow-y: auto; }
    table { margin: 0 auto; border-collapse: collapse; }
    td, th { border: 1px solid #777; padding: 5px; }
  </style>
</head>
<body>
  <h2>Sistema de Sinais - Pullback com Rejeição (Quotex)</h2>

  <div>
    Par:
    <select id="pair" onchange="atualizarGrafico()">
      <!-- Lista de ativos populares no TradingView -->
      <option value="BINANCE:BTCUSDT">BTC/USDT</option>
      <option value="BINANCE:ETHUSDT">ETH/USDT</option>
      <option value="BINANCE:XRPUSDT">XRP/USDT</option>
      <option value="BINANCE:LTCUSDT">LTC/USDT</option>
      <option value="BINANCE:ADAUSDT">ADA/USDT</option>
      <option value="BINANCE:SOLUSDT">SOL/USDT</option>
      <option value="BINANCE:BNBUSDT">BNB/USDT</option>
      <option value="BINANCE:DOGEUSDT">DOGE/USDT</option>
      <option value="BINANCE:DOTUSDT">DOT/USDT</option>
      <option value="BINANCE:SHIBUSDT">SHIB/USDT</option>
      <!-- Adicione mais ativos conforme necessário -->
    </select>
    Tempo:
    <select id="interval" onchange="atualizarGrafico()">
      <option value="1m">M1</option>
      <option value="5m" selected>M5</option>
      <option value="15m">M15</option>
    </select>
    <button onclick="carregar(true)">Atualizar</button>
  </div>

  <!-- Gráfico do TradingView -->
  <div class="tradingview-widget-container">
    <div id="tradingview_01"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
      let widget;  // Declaramos a variável do widget para atualizar o gráfico

      // Função para atualizar o gráfico com base na seleção do ativo
      function atualizarGrafico() {
        const pair = document.getElementById('pair').value;
        const interval = document.getElementById('interval').value;

        // Se o widget já estiver criado, destruímos e recriamos ele para atualizar
        if (widget) {
          widget.remove();
        }

        // Criação do novo widget com o par e intervalo selecionados
        widget = new TradingView.widget({
          "width": 800,
          "height": 400,
          "symbol": pair,
          "interval": interval,
          "timezone": "Etc/UTC",
          "theme": "dark",
          "style": "1",
          "locale": "br",
          "toolbar_bg": "#222",
          "enable_publishing": false,
          "hide_top_toolbar": false,
          "allow_symbol_change": true,
          "container_id": "tradingview_01"
        });
      }

      // Função para carregar dados iniciais
      async function carregar(reset = false) {
        const pair = document.getElementById('pair').value;
        const interval = document.getElementById('interval').value;
        analisarSinal(pair);
        verificarSinais();
      }

      function analisarSinal(par) {
        const sinalDiv = document.getElementById('sinal');
        sinalDiv.innerText = `SINAL: PUT detectado!`;
        sinalDiv.style.color = 'red';
        document.getElementById('alerta').play();
        adicionarHistorico(par, 'PUT', new Date().toLocaleTimeString());
      }

      function adicionarHistorico(par, direcao, hora) {
        const tabela = document.getElementById('tabela');
        const tr = document.createElement('tr');
        tr.setAttribute('data-index', hora);
        tr.innerHTML = `<td>${hora}</td><td>${par}</td><td>${direcao}</td><td id="resultado-${hora}">⏳</td>`;
        tabela.appendChild(tr);
      }

      function verificarSinais() {
        // Exemplo de verificação de sinal
        const sinal = document.querySelector('#tabela tr[data-index]');
        const tdResultado = sinal.querySelector('td:last-child');
        tdResultado.textContent = '✅ GREEN';
        tdResultado.style.color = 'lime';
      }

      carregar(true);  // Carrega os dados iniciais
    </script>
  </div>

  <div id="sinal">Analisando...</div>

  <div id="historico">
    <h4>Histórico de Sinais</h4>
    <table id="tabela">
      <tr><th>Hora</th><th>Par</th><th>Sinal</th><th>Resultado</th></tr>
    </table>
  </div>

  <audio id="alerta" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
</body>
</html>
