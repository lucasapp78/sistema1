<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sinal Automático - Pullback M5</title>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; text-align: center; }
    select, button { margin: 10px; padding: 6px; }
    #sinal { font-size: 24px; font-weight: bold; margin-top: 10px; }
    #historico { margin-top: 20px; max-height: 200px; overflow-y: auto; }
    table { margin: 0 auto; border-collapse: collapse; }
    td, th { border: 1px solid #777; padding: 5px; }
  </style>
</head>
<body>
  <h2>Sistema de Sinais - Pullback com Rejeição (Quotex)</h2>

  <div>
    Par:
    <select id="pair">
      <option value="BTCUSDT">BTC/USDT</option>
      <option value="ETHUSDT">ETH/USDT</option>
    </select>
    Tempo:
    <select id="interval">
      <option value="1m">M1</option>
      <option value="5m" selected>M5</option>
      <option value="15m">M15</option>
    </select>
    <button onclick="carregar(true)">Atualizar</button>
  </div>

  <!-- Gráfico do TradingView -->
  <div class="tradingview-widget-container">
    <div id="tradingview_01"></div>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script type="text/javascript">
      new TradingView.widget({
        "width": 800,
        "height": 400,
        "symbol": "BINANCE:BTCUSDT",
        "interval": "5",
        "timezone": "Etc/UTC",
        "theme": "dark",
        "style": "1",
        "locale": "br",
        "toolbar_bg": "#222",
        "enable_publishing": false,
        "hide_top_toolbar": false,
        "allow_symbol_change": true,
        "container_id": "tradingview_01"
      });
    </script>
  </div>

  <div id="sinal">Analisando...</div>

  <div id="historico">
    <h4>Histórico de Sinais</h4>
    <table id="tabela">
      <tr><th>Hora</th><th>Par</th><th>Sinal</th><th>Resultado</th></tr>
    </table>
  </div>

  <audio id="alerta" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

  <script>
    let sinaisPendentes = [];

    async function carregar(reset = false) {
      const pair = document.getElementById('pair').value;
      const interval = document.getElementById('interval').value;

      // Logica de analise do sinal aqui, removi a parte que puxa dados de gráficos diretamente via API.
      analisarSinal(pair);
      verificarSinais();
    }

    function analisarSinal(par) {
      const sinalDiv = document.getElementById('sinal');
      // A lógica de sinais ainda está aqui, você pode adaptar para sua estratégia de pullback.

      // Exemplo de lógica de sinal PUT (você pode adaptar a lógica conforme necessário):
      sinalDiv.innerText = `SINAL: PUT detectado!`;
      sinalDiv.style.color = 'red';
      document.getElementById('alerta').play();
      adicionarHistorico(par, 'PUT', new Date().toLocaleTimeString());
    }

    function adicionarHistorico(par, direcao, hora) {
      sinaisPendentes.push({ hora, par, direcao, resolvido: false });
      const tabela = document.getElementById('tabela');
      const tr = document.createElement('tr');
      tr.setAttribute('data-index', hora);
      tr.innerHTML = `<td>${hora}</td><td>${par}</td><td>${direcao}</td><td id="resultado-${hora}">⏳</td>`;
      tabela.appendChild(tr);
    }

    function verificarSinais() {
      sinaisPendentes.forEach(sinal => {
        // Exemplo de verificação do sinal, você pode adaptar conforme sua lógica de resultado
        const tdResultado = document.getElementById(`resultado-${sinal.hora}`);
        tdResultado.textContent = '✅ GREEN';  // Pode ser baseado em algum critério de sua análise
        tdResultado.style.color = 'lime';
        sinal.resolvido = true;
      });
    }

    carregar(true);
    setInterval(() => carregar(), 60000); // Atualiza a cada 1 min
  </script>
</body>
</html>
